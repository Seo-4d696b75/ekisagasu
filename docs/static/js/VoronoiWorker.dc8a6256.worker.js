!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/ekisagasu/",n(n.s=2)}([function(t,e,n){t.exports=n(1)},function(t,e,n){var r=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,i="function"===typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(j){u=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var i=e&&e.prototype instanceof y?e:y,o=Object.create(i.prototype),s=new I(r||[]);return o._invoke=function(t,e,n){var r=l;return function(i,o){if(r===d)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw o;return N()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=S(s,n);if(a){if(a===v)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var u=h(t,e,n);if("normal"===u.type){if(r=n.done?p:f,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=p,n.method="throw",n.arg=u.arg)}}}(t,n,s),o}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(j){return{type:"throw",arg:j}}}t.wrap=c;var l="suspendedStart",f="suspendedYield",d="executing",p="completed",v={};function y(){}function x(){}function w(){}var b={};b[o]=function(){return this};var g=Object.getPrototypeOf,m=g&&g(g(L([])));m&&m!==n&&r.call(m,o)&&(b=m);var _=w.prototype=y.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function n(i,o,s,a){var u=h(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"===typeof l&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,s,a)}),(function(t){n("throw",t,s,a)})):e.resolve(l).then((function(t){c.value=t,s(c)}),(function(t){return n("throw",t,s,a)}))}a(u.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function S(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,S(t,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=h(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var o=i.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function L(t){if(t){var n=t[o];if(n)return n.call(t);if("function"===typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}return{next:N}}function N(){return{value:e,done:!0}}return x.prototype=_.constructor=w,w.constructor=x,x.displayName=u(w,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"===typeof t&&t.constructor;return!!e&&(e===x||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,a,"GeneratorFunction")),t.prototype=Object.create(_),t},t.awrap=function(t){return{__await:t}},k(P.prototype),P.prototype[s]=function(){return this},t.AsyncIterator=P,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var s=new P(c(e,n,r,i),o);return t.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},k(_),u(_,a,"Generator"),_[o]=function(){return this},_.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=L,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return a.type="throw",a.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var u=r.call(s,"catchLoc"),c=r.call(s,"finallyLoc");if(u&&c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;O(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:L(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}(t.exports);try{regeneratorRuntime=r}catch(i){Function("r","regeneratorRuntime = r")(r)}},function(t,e,n){"use strict";n.r(e);var r=n(0),i=n.n(r);function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"===typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,s=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw s}}}}function a(t,e,n,r,i,o,s){try{var a=t[o](s),u=a.value}catch(c){return void n(c)}a.done?e(u):Promise.resolve(u).then(r,i)}function u(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){a(o,r,i,s,u,"next",t)}function u(t){a(o,r,i,s,u,"throw",t)}s(void 0)}))}}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function h(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function v(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function y(t){return(y="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function x(t,e){return!e||"object"!==y(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function w(t){var e=v();return function(){var n,r=p(t);if(e){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return x(this,n)}}function b(t,e,n){return(b=v()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&f(i,n.prototype),i}).apply(null,arguments)}function g(t){var e="function"===typeof Map?new Map:void 0;return(g=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!==typeof t)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return b(t,arguments,p(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),f(r,t)})(t)}var m,_=function(t){d(n,t);var e=w(n);function n(){return l(this,n),e.apply(this,arguments)}return n}(g(Error));m=Symbol.iterator;var k=function(){function t(e,n,r){var i=this;l(this,t),this.compare=void 0,this.hash=void 0,this.map=void 0,this.compare=e,this.hash=n,this.map=new Map,r&&r.forEach((function(t){i.add(t)}))}return h(t,[{key:"clone",value:function(){var e,n=new t(this.compare,this.hash),r=s(this.map.entries());try{for(r.s();!(e=r.n()).done;){var i=e.value,o=i[0],a=i[1];n.map.set(o,Array.from(a))}}catch(u){r.e(u)}finally{r.f()}return n}},{key:"add",value:function(t){var e=this,n=this.hash(t),r=this.map.get(n);return r?!!r.every((function(n){return!e.compare(n,t)}))&&(r.push(t),!0):(r=[t],this.map.set(n,r),!0)}},{key:"has",value:function(t){var e=this,n=this.map.get(this.hash(t));return!!n&&n.some((function(n){return e.compare(n,t)}))}},{key:"remove",value:function(t){var e=this,n=this.hash(t),r=this.map.get(n);if(r){if(1===r.length&&this.compare(r[0],t))return this.map.delete(n),!0;var i=r.filter((function(n){return!e.compare(n,t)}));return r.length!==i.length&&(this.map.set(n,i),!0)}return!1}},{key:"size",value:function(){var t,e=0,n=s(this.map.values());try{for(n.s();!(t=n.n()).done;){e+=t.value.length}}catch(r){n.e(r)}finally{n.f()}return e}},{key:"clear",value:function(){this.map.clear()}},{key:"forEach",value:function(t){var e,n=s(this);try{for(n.s();!(e=n.n()).done;){t(e.value)}}catch(r){n.e(r)}finally{n.f()}}},{key:m,value:i.a.mark((function t(){var e,n,r,o,a,u,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=0,n=s(this.map.values()),t.prev=2,n.s();case 4:if((r=n.n()).done){t.next=26;break}o=r.value,a=s(o),t.prev=7,a.s();case 9:if((u=a.n()).done){t.next=16;break}return c=u.value,e+=1,t.next=14,c;case 14:t.next=9;break;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(7),a.e(t.t0);case 21:return t.prev=21,a.f(),t.finish(21);case 24:t.next=4;break;case 26:t.next=31;break;case 28:t.prev=28,t.t1=t.catch(2),n.e(t.t1);case 31:return t.prev=31,n.f(),t.finish(31);case 34:return t.abrupt("return",e);case 35:case"end":return t.stop()}}),t,this,[[2,28,31,34],[7,18,21,24]])}))},{key:"filter",value:function(e){var n,r=new t(this.compare,this.hash),i=s(this);try{for(i.s();!(n=i.n()).done;){var o=n.value;e(o)&&r.add(o)}}catch(a){i.e(a)}finally{i.f()}return r}},{key:"removeIf",value:function(e){var n,r=new t(this.compare,this.hash),i=s(this);try{for(i.s();!(n=i.n()).done;){var o=n.value;e(o)||r.add(o)}}catch(a){i.e(a)}finally{i.f()}return r}}]),t}(),P=function(t,e){if(Number.isFinite(t)&&Number.isFinite(e))return{x:t,y:e};throw new S(t,e)}(0,0),S=function(t){d(n,t);var e=w(n);function n(t,r){return l(this,n),e.call(this,"cannot get an instance with x:".concat(t," y:").concat(r))}return n}(_);function E(t,e){return e&&Number.isInteger(e)&&e>0?"(".concat(t.x.toFixed(e),",").concat(t.y.toFixed(e),")"):"(".concat(t.x,",").concat(t.y,")")}function O(t){return null!==t&&"object"===typeof t&&"number"===typeof t.x&&"number"===typeof t.y}function I(t,e){return t.x===e.x&&t.y===e.y}function L(t){return function(t){var e=5381;if("string"===typeof t)for(var n=t.length-1;n>=0;)e=33*e^t.charCodeAt(n),n--;return e&e}("".concat(t.x.toString(),",").concat(t.y.toString))}function N(t,e){return t.x===e.x?t.y===e.y?0:t.y<e.y?-1:1:t.x<e.x?-1:1}function j(t){return null!==t&&"object"===typeof t&&O(t.a)&&O(t.b)}function M(t){return T(t.a,t.b)}var B=function(t){d(n,t);var e=w(n);function n(){return l(this,n),e.apply(this,arguments)}return n}(_),F=function(t){d(n,t);var e=w(n);function n(t,r){return l(this,n),e.call(this,r?"".concat(t," line:").concat(function(t){return"{ax+by+c=0 with a:".concat(t.a,",b:").concat(t.b,",c:").concat(t.c,"}")}(r)):t)}return n}(_);function T(t,e,n){if("number"===typeof t&&"number"===typeof e){if("number"===typeof n){if(0===e){if(0===t)throw new B("a = b = 0");return{a:1,b:0,c:n/t}}return{a:t/e,b:1,c:n/e}}return{a:-t,b:1,c:-e}}if(O(t)&&O(e)){if(I(t,e))throw new B("duplicated point: ".concat(E(t)));return t.x===e.x?{a:1,b:0,c:-(t.x+e.x)/2}:{a:(e.y-t.y)/(t.x-e.x),b:1,c:(e.x*t.y-t.x*e.y)/(t.x-e.x)}}throw new B("cannot get an instance with a:".concat(t," b:").concat(e," c:").concat(n))}function A(t,e){if(j(e)){var n=t,r=e;if(!((n.a*r.a.x+n.b*r.a.y+n.c)*(n.a*r.b.x+n.b*r.b.y+n.c)<=0))return null;e=M(r)}var i=t.a*e.b-e.a*t.b;return 0===i?null:{x:(t.b*e.c-e.b*t.c)/i,y:(e.a*t.c-t.a*e.c)/i}}var z=function(t){d(n,t);var e=w(n);function n(t){return l(this,n),e.call(this,t)}return n}(_);function R(t){switch(t){case"up":return"down";case"down":return"up";case"zero":return"zero"}}var G=Math.pow(2,-30),q=function(){function t(e,n,r){l(this,t),this.x=void 0,this.y=void 0,this._p1=void 0,this._p2=void 0,this.index=void 0,this.onBoundary=void 0,this.x=e.x,this.y=e.y,this._p1=n,this._p2=r;var i=0;n.line.isBoundary&&i++,r.line.isBoundary&&i++,0===i?(this.onBoundary=!1,this.index=-1):1===i?(this.onBoundary=!0,this.index=-1):(this.onBoundary=!1,this.index=0)}return h(t,[{key:"p1",get:function(){if(this._p1)return this._p1;throw new z("no intersection")}},{key:"p2",get:function(){if(this._p2)return this._p2;throw new z("no intersection")}},{key:"next",value:function(t){var e=this.p1,n=this.p2;if(e.hasNext&&I(e.next,t))return this.calcNext(e,n,!1,R(e.step));if(e.hasPrevious&&I(e.previous,t))return this.calcNext(e,n,!0,e.step);if(n.hasNext&&I(n.next,t))return this.calcNext(n,e,!1,R(n.step));if(n.hasPrevious&&I(n.previous,t))return this.calcNext(n,e,!0,n.step);throw new z("next node not found.")}},{key:"calcNext",value:function(t,e,n,r){return this.onBoundary&&this.index>0?n?t.next.node:t.previous.node:e.neighbor(R(r)).node}},{key:"nextDown",value:function(t){var e=null;if(this.p1.isNeighbor(t))e=this.p2;else{if(!this.p2.isNeighbor(t))throw new z("neighbor not found");e=this.p1}return e.hasNeighbor("down")?e.neighbor("down").node:e.neighbor("zero").node}},{key:"nextUp",value:function(t){var e=null,n=null;if(this.p1.isNeighbor(t))e=this.p2,n=this.p1;else{if(!this.p2.isNeighbor(t))throw new z("neighbor not found");e=this.p1,n=this.p2}return e.hasNeighbor("up")?e.neighbor("up").node:n.hasNeighbor("up")?n.neighbor("up").node:null}},{key:"onSolved",value:function(t){if(this.p1.onSolved(),this.p2.onSolved(),this.index<0)this.p1.line.isBoundary||this.p2.line.isBoundary?this.index=t:this.index=t+.5;else if(Math.round(this.index)!==this.index&&this.index+.5!==t)throw new z("index mismatch")}},{key:"hasSolved",value:function(){return this.index>=0}},{key:"release",value:function(){this._p1=null,this._p2=null}}]),t}(),J=function(){function t(e,n,r,i){if(l(this,t),this.x=void 0,this.y=void 0,this.line=void 0,this.step=void 0,this._previous=void 0,this._next=void 0,this.index=0,this._node=null,this.line=n,this.x=e.x,this.y=e.y,r&&i){var o=n.line.b,s=-n.line.a;(o<0||0===o&&s<0)&&(o*=-1,s*=-1);var a={x:e.x+o,y:e.y+s};this.step=(c=a,h=i,((u=r).a*c.x+u.b*c.y+u.c)*(u.a*h.x+u.b*h.y+u.c)>=0?"down":"up")}else this.step="zero";var u,c,h}return h(t,[{key:"hasPrevious",get:function(){if(void 0===this._previous)throw new z("previous not init yet");return null!==this._previous}},{key:"previous",get:function(){if(this._previous)return this._previous;if(void 0===this._previous)throw new z("previous not init yet");throw new z("no previous")}},{key:"hasNext",get:function(){if(void 0===this._next)throw new z("next not init yet");return null!==this._next}},{key:"next",get:function(){if(this._next)return this._next;if(void 0===this._next)throw new z("next not init yet");throw new z("no next")}},{key:"node",get:function(){if(this._node)return this._node;throw new z("no node")},set:function(t){if(this._node)throw new z("node already set");this._node=t}},{key:"insert",value:function(t,e,n){this._previous=t,this._next=e,this._previous&&(this._previous._next=this),this._next&&(this._next._previous=this,this._next.incrementIndex()),this.index=n}},{key:"incrementIndex",value:function(){this.index++,this._next&&this._next.incrementIndex()}},{key:"isNeighbor",value:function(t){return this.hasNext&&I(this.next,t)||this.hasPrevious&&I(this.previous,t)}},{key:"hasNeighbor",value:function(t){return"zero"===t&&"zero"===this.step||"zero"!==t&&"zero"!==this.step&&(t===this.step?!!this._next:!!this._previous)}},{key:"neighbor",value:function(t){if("zero"===t&&"zero"===this.step){if(this._previous)return this._previous;if(this._next)return this._next}else if("zero"!==t&&"zero"!==this.step)return t===this.step?this.next:this.previous;throw new z("neighbor step invalid.")}},{key:"onSolved",value:function(){this.line.onIntersectionSolved(this)}},{key:"release",value:function(){this._previous=null,this._next=null,this._node&&(this._node.release(),this._node=null)}}]),t}(),D=function(){function t(e,n){l(this,t),this.line=void 0,this.intersections=void 0,this.isBoundary=void 0,this.delaunayPoint=void 0,this.solvedPointIndexFrom=Number.MAX_SAFE_INTEGER,this.solvedPointIndexTo=-1,this.line=e,this.intersections=[],n?(this.delaunayPoint=n,this.isBoundary=!1):(this.delaunayPoint=null,this.isBoundary=!0)}return h(t,[{key:"inspectBoundary",value:function(t){var e=A(this.line,t);if(e){var n=new J(e,this);this.addIntersection(n)}}},{key:"onIntersectionSolved",value:function(t){var e=t.index;this.solvedPointIndexFrom=Math.min(this.solvedPointIndexFrom,e),this.solvedPointIndexTo=Math.max(this.solvedPointIndexTo,e)}},{key:"addIntersection",value:function(t){var e=this.intersections.length,n=this.addIntersectionAt(t,0,e);if(t.insert(n>0?this.intersections[n-1]:null,n<e?this.intersections[n]:null,n),this.intersections.splice(n,0,t),this.solvedPointIndexFrom<this.solvedPointIndexTo)if(n<=this.solvedPointIndexFrom)this.solvedPointIndexFrom++,this.solvedPointIndexTo++;else if(n<=this.solvedPointIndexTo)throw new z("new intersection added to solved range.")}},{key:"addIntersectionAt",value:function(t,e,n){if(e===n)return e;var r=Math.floor((e+n-1)/2),i=N(t,this.intersections[r]);if(i<0)return this.addIntersectionAt(t,e,r);if(i>0)return this.addIntersectionAt(t,r+1,n);throw new z("same point already added in this bisector")}},{key:"release",value:function(){this.intersections.forEach((function(t){return t.release()})),this.intersections.splice(0,this.intersections.length)}}]),t}(),C=function(){function t(e,n){l(this,t),this.container=void 0,this.provider=void 0,this.running=!1,this.center=P,this.level=0,this.targetLevel=1,this.list=null,this.time=0,this.result=[],this.callback=null,this.bisectors=[],this.requestedPoint=new k(I,L),this.addedPoint=new k(I,L),this.container=e,this.provider=n}return h(t,[{key:"execute",value:function(){var t=u(i.a.mark((function t(e,n,r){var o,a,u,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.running){t.next=2;break}return t.abrupt("return",Promise.reject("already running"));case 2:return this.running=!0,t.prev=3,this.center=n,this.level=e,this.targetLevel=1,this.list=null,this.time=performance.now(),this.result=[],this.callback=r,this.bisectors=[],this.addBoundary(T(this.container.a,this.container.b)),this.addBoundary(T(this.container.b,this.container.c)),this.addBoundary(T(this.container.c,this.container.a)),this.requestedPoint=new k(I,L),this.addedPoint=new k(I,L),this.requestedPoint.add(n),this.addedPoint.add(n),t.next=21,this.provider(n);case 21:o=t.sent,a=s(o);try{for(a.s();!(u=a.n()).done;)c=u.value,this.addedPoint.add(c)&&this.addBisector(c)}catch(i){a.e(i)}finally{a.f()}t.next=29;break;case 26:return t.prev=26,t.t0=t.catch(3),t.abrupt("return",Promise.reject(t.t0));case 29:return t.abrupt("return",this.searchPolygon());case 30:case"end":return t.stop()}}),t,this,[[3,26]])})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"searchPolygon",value:function(){var t=u(i.a.mark((function t(){var e,n,r,o,s=this;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=performance.now(),n=[],(r=this.traverse(this.list,n)).forEach((function(t){return t.onSolved(s.targetLevel)})),this.result.push(r),this.list=r,t.next=8,Promise.all(n);case 8:if(console.log("execute index:".concat(this.targetLevel," time:").concat(performance.now()-e)),this.callback&&this.list&&this.callback(this.targetLevel-1,this.list),!((o=this.targetLevel+1)<=this.level)){t.next=16;break}return this.targetLevel=o,t.abrupt("return",this.searchPolygon());case 16:return this.bisectors.forEach((function(t){return t.release()})),console.log("execute done. time:".concat(performance.now()-this.time)),this.running=!1,t.abrupt("return",this.result);case 20:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"traverse",value:function(t,e){var n=null,r=null;if(t){r=t[t.length-1];var i,o=s(t);try{for(o.s();!(i=o.n()).done;){var a=i.value;if(n=a.nextUp(r),r=a,n&&!n.hasSolved())break}}catch(f){o.e(f)}finally{o.f()}}else{var u=new k(I,L),c=this.bisectors[0];for(n=c.intersections[1].node,r=c.intersections[0].node;u.add(n);){var h=n;n=h.nextDown(r),r=h}}if(!n||!r||n.hasSolved())throw new z("fail to traverse polygon");var l=n;for(t=[l];this.requestExtension(n.p1.line.delaunayPoint,e),this.requestExtension(n.p2.line.delaunayPoint,e),n=(h=n).next(r),r=h,!I(l,n);)t.push(n);return t}},{key:"requestExtension",value:function(t,e){var n=this;if(t&&this.requestedPoint.add(t)){var r=this.provider(t).then((function(t){var e,r=s(t);try{for(r.s();!(e=r.n()).done;){var i=e.value;n.addedPoint.add(i)&&n.addBisector(i)}}catch(o){r.e(o)}finally{r.f()}}));e.push(r)}}},{key:"addBoundary",value:function(t){var e=new D(t);this.bisectors.forEach((function(t){var n=A(e.line,t.line);if(!n)throw new z("intersection not found");var r=new J(n,e),i=new J(n,t),o=new q(n,r,i);r.node=o,i.node=o,e.addIntersection(r),t.addIntersection(i)})),this.bisectors.push(e)}},{key:"addBisector",value:function(t){var e=this,n=new D(function(t,e){if(j(t)){var n=t;t=n.a,e=n.b}if(e)return{a:t.x-e.x,b:t.y-e.y,c:(-Math.pow(t.x,2)-Math.pow(t.y,2)+Math.pow(e.x,2)+Math.pow(e.y,2))/2};throw new F("invalid arguments p1:".concat(t,",p2:").concat(e))}(t,this.center),t);this.bisectors.forEach((function(t){var r=A(n.line,t.line);if(r&&function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=t.a.x-e.x,i=t.a.y-e.y,o=t.b.x-e.x,s=t.b.y-e.y,a=t.c.x-e.x,u=t.c.y-e.y,c=r*s-i*o,h=o*u-s*a,l=a*i-u*r;return n&&n>0?c>-n&&h>-n&&l>-n||c<n&&h<n&&l<n:c>=0&&h>=0&&l>=0||c<=0&&h<=0&&l<=0}(e.container,r,G)){var i=new J(r,n,t.line,e.center),o=new J(r,t,n.line,e.center),s=new q(r,i,o);i.node=s,o.node=s,n.addIntersection(i),t.addIntersection(o)}})),this.bisectors.push(n)}}]),t}(),U=self,Y={voronoi:null,promise:new Map};U.addEventListener("message",(function(t){var e=JSON.parse(t.data);if(console.log("worker",e),"start"===e.type){var n=e.container;Y.voronoi=new C(n,(function(t){return new Promise((function(e,n){Y.promise.set(t.code,e),U.postMessage(JSON.stringify({type:"points",code:t.code}))}))})),Y.voronoi.execute(e.k,e.center,(function(t,e){U.postMessage(JSON.stringify({type:"progress",index:t,polygon:e.map((function(t){return{lat:t.y,lng:t.x}}))}))})).then((function(){U.postMessage(JSON.stringify({type:"complete"}))})).catch((function(t){console.log(t),U.postMessage(JSON.stringify({type:"error",err:t.message}))}))}else if("points"===e.type){var r=Y.promise.get(e.code);if(!r)throw new Error("no promise code:".concat(e.code));Y.promise.delete(e.code),r(e.points)}}))}]);
//# sourceMappingURL=VoronoiWorker.dc8a6256.worker.js.map